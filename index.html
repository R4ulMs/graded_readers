<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Reader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <style>
        html {
            -webkit-text-size-adjust: 100%;
        }

        :root {
            --topbar-h: clamp(32px, 5vh, 44px);
            --footer-h: clamp(44px, 7vh, 64px);
            --tip-safe: clamp(64px, 10vh, 128px);
            --col-ch: 62;
        }

        @media (max-width: 480px) {
            :root {
                --col-ch: 44;
            }
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            background: #1c1c1c;
            font-family: "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            font-weight: 400;
            font-size: clamp(19px, 2.6vh, 24px);
            line-height: 1.58;
            letter-spacing: .32px;
            text-align: left;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
        }

        .reader {
            width: 100%;
            max-width: min(994px, calc(var(--col-ch)*1ch));
            padding: clamp(20px, 3.5vh, 40px) clamp(16px, 4vw, 48px);
            color: #cfcfcf;
            background: #000;
            box-sizing: border-box;
            height: calc(100vh - var(--topbar-h) - var(--footer-h));
            margin-top: var(--topbar-h);
            margin-bottom: var(--footer-h);
            overflow: hidden;
        }

        .reader .phrase:hover {
            background: #2a2a2a;
            color: #fff;
            cursor: pointer;
        }

        .topbar {
            position: fixed;
            inset: 0 0 auto 0;
            height: var(--topbar-h);
            background: #000;
            display: grid;
            place-items: center;
            border-bottom: 1px solid #1f1f1f;
            z-index: 10;
            padding-top: env(safe-area-inset-top);
        }

        .topbar.title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
        }

        .footer {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: var(--footer-h);
            background: #000;
            display: flex;
            align-items: center;
            justify-content: space-around;
            color: #ccc;
            font-size: clamp(14px, 1.8vh, 16px);
            border-top: 1px solid #333;
            z-index: 10;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
        }

        .footer .progress {
            font-size: clamp(12px, 1.6vh, 14px);
        }

        .footer .nav-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: clamp(22px, 3.8vh, 26px);
            cursor: pointer;
            padding: 8px;
        }

        .footer .nav-btn:hover {
            color: #fff;
        }

        #measurer {
            position: absolute;
            visibility: hidden;
            left: -9999px;
            top: -9999px;
            padding: 40px 125px;
            box-sizing: border-box;
            font-size: inherit;
            line-height: inherit;
            letter-spacing: .32px;
            white-space: normal;
            text-align: left;
        }

        .tip-wrap {
            position: relative;
            display: inline-block;
        }

        .tip-trigger {
            cursor: pointer;
        }

        .tooltip {
            position: absolute;
            left: 0;
            top: 100%;
            transform: translateY(8px);
            width: 280px;
            max-width: min(80vw, 400px);
            padding: 8px 10px;
            border: 2px solid #ccc;
            background: #141414;
            color: #fff;
            font-size: 14px;
            line-height: 1.3;
            white-space: normal;
            overflow-wrap: anywhere;
            opacity: 0;
            pointer-events: none;
            transition: opacity .12s ease;
            z-index: 12;
        }

        .tooltip::before,
        .tooltip::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 14px;
            width: 0;
            height: 0;
            border: solid transparent;
            pointer-events: none;
        }

        .tooltip::before {
            border-width: 8px;
            border-bottom-color: #ccc;
            margin-left: -2px;
        }

        .tooltip::after {
            border-width: 6px;
            border-bottom-color: #141414;
        }

        .tip-wrap[data-open="true"] .tooltip {
            opacity: 1;
            pointer-events: auto;
        }

        .reader p {
            margin: 0 0 .65em;
        }
    </style>
</head>

<body>
    <header class="topbar">
        <div class="topbar title">A Sea of Darkness</div>
    </header>
    <div class="reader"></div>
    <div class="footer">
        <button class="nav-btn">❮</button>
        <span class="progress">0%</span>
        <button class="nav-btn">❯</button>
    </div>
    <div id="measurer" aria-hidden="true"></div>

    <script>
        const TIP_SAFE = Math.max(64, Math.min(window.innerHeight * 0.10, 128));
        const STORAGE_KEY = "reader:page:v1";
        const TIP_FOLGA = 80; // px de folga para o tooltip aparecer acima do rodapé

        const story = {
            "page1": [
                { "phrase": "Late in the winter", "tooltip": "Tarde/no fim do inverno" },
                { "phrase": "of my seventeenth year,", "tooltip": "do meu décimo sétimo ano" },
                { "phrase": "my mother decided", "tooltip": "minha mãe decidiu" },
                { "phrase": "I was depressed,", "tooltip": "que eu estava deprimida" },
                { "phrase": "presumably because", "tooltip": "presumivelmente porque" },
                { "phrase": "I rarely left the house,", "tooltip": "eu raramente deixava a casa" },
                { "phrase": "spent quite a lot of time in bed,", "tooltip": "passava bastante tempo na cama" },
                { "phrase": "read the same book over and over,", "tooltip": "lia o mesmo livro repetidamente" },
                { "phrase": "ate infrequently,", "tooltip": "comia infrequentemente" },
                { "phrase": "and devoted quite a bit of my abundant free time", "tooltip": "e dedicava bastante do meu abundante tempo livre" },
                { "phrase": "to thinking about death.", "tooltip": "a pensar sobre a morte" },
                { "phrase": "Whenever you read", "tooltip": "Sempre que você lê" },
                { "phrase": "a cancer booklet or website or whatever,", "tooltip": "um livreto de câncer ou site ou seja o que for" },
                { "phrase": "they always list depression", "tooltip": "eles sempre listam depressão" },
                { "phrase": "among the side effects of cancer.", "tooltip": "entre os efeitos colaterais de câncer" },
                { "phrase": "But, in fact,", "tooltip": "Mas, de fato" },
                { "phrase": "depression is not a side effect of cancer.", "tooltip": "depressão não é um efeito colateral de câncer" },
                { "phrase": "Depression is a side effect of dying.", "tooltip": "depressão é um efeito colateral de morrer" },
                { "phrase": "(Cancer is also a side effect of dying.", "tooltip": "(câncer também é um efeito colateral de morrer" },
                { "phrase": "Almost everything is, really.)", "tooltip": "quase tudo é, na verdade.)" },
                { "phrase": "But my mom believed I required treatment,", "tooltip": "mas minha mãe acreditava que eu precisava de tratamento" },
                { "phrase": "so she took me to see my Regular Doctor Jim,", "tooltip": "então ela me levou para ver meu Médico Regular Jim" },
                { "phrase": "who agreed that I was veritably swimming", "tooltip": "que concordou que eu estava verdadeiramente nadando" },
                { "phrase": "in a paralyzing and totally clinical depression,", "tooltip": "em uma depressão paralisante e totalmente clínica" },
                { "phrase": "and that therefore", "tooltip": "e que portanto" },
                { "phrase": "my meds should be adjusted", "tooltip": "meus remédios deveriam ser ajustados" },
                { "phrase": "and also I should attend", "tooltip": "e também eu deveria frequentar" },
                { "phrase": "a weekly Support Group.", "tooltip": "um Grupo de Apoio semanal" },
                { "phrase": "This Support Group featured", "tooltip": "esse Grupo de Apoio apresentava" },
                { "phrase": "a rotating cast of characters", "tooltip": "um elenco rotativo de personagens" },
                { "phrase": "in various states of tumor-driven unwellness.", "tooltip": "em vários estados de mal-estar dirigido por tumor" },
                { "phrase": "Why did the cast rotate?", "tooltip": "por que o elenco rotacionava?" },
                { "phrase": "A side effect of dying.", "tooltip": "um efeito colateral de morrer" },
                { "phrase": "The Support Group, of course,", "tooltip": "o Grupo de Apoio, claro" },
                { "phrase": "was depressing as hell.", "tooltip": "era deprimente como o inferno" },
                { "phrase": "It met every Wednesday", "tooltip": "se reunia toda quarta-feira" },
                { "phrase": "in the basement of a stone-walled Episcopal church", "tooltip": "no porão de uma igreja Episcopal de paredes de pedra" },
                { "phrase": "shaped like a cross.", "tooltip": "em formato de cruz" },
                { "phrase": "We all sat in a circle", "tooltip": "nós todos sentávamos em um círculo" },
                { "phrase": "right in the middle of the cross,", "tooltip": "bem no meio da cruz" },
                { "phrase": "where the two boards would have met,", "tooltip": "onde as duas tábuas teriam se encontrado" },
                { "phrase": "where the heart of Jesus would have been.", "tooltip": "onde o coração de Jesus teria estado" },
                { "phrase": "I noticed this because Patrick,", "tooltip": "eu notei isso porque Patrick" },
                { "phrase": "the Support Group Leader", "tooltip": "o Líder do Grupo de Apoio" },
                { "phrase": "and only person over eighteen in the room,", "tooltip": "e única pessoa acima de dezoito na sala" },
                { "phrase": "talked about the heart of Jesus", "tooltip": "falava sobre o coração de Jesus" },
                { "phrase": "every freaking meeting,", "tooltip": "toda maldita reunião" },
                { "phrase": "all about how we,", "tooltip": "tudo sobre como nós" },
                { "phrase": "as young cancer survivors,", "tooltip": "como jovens sobreviventes de câncer" },
                { "phrase": "were sitting right in Christ’s very sacred heart", "tooltip": "estávamos sentados bem no muito sagrado coração de Cristo" },
                { "phrase": "and whatever.", "tooltip": "e seja lá o que for" },
                { "phrase": "So here’s how it went in God’s heart:", "tooltip": "então aqui está como acontecia no coração de Deus:" },
                { "phrase": "The six or seven or ten of us", "tooltip": "nós seis ou sete ou dez" },
                { "phrase": "walked/wheeled in,", "tooltip": "entrávamos andando/rodando" },
                { "phrase": "grazed at a decrepit selection of cookies and lemonade,", "tooltip": "beliscávamos uma seleção decrépita de biscoitos e limonada" },
                { "phrase": "sat down in the Circle of Trust,", "tooltip": "sentávamos no Círculo da Confiança" },
                { "phrase": "and listened to Patrick recount", "tooltip": "e ouvíamos Patrick recontar" },
                { "phrase": "for the thousandth time", "tooltip": "pela milésima vez" },
                { "phrase": "his depressingly miserable life story—", "tooltip": "sua deprimente e miserável história de vida—" },
                { "phrase": "how he had cancer in his balls", "tooltip": "como ele teve câncer nas bolas" },
                { "phrase": "and they thought he was going to die", "tooltip": "e eles acharam que ele ia morrer" },
                { "phrase": "but he didn’t die", "tooltip": "mas ele não morreu" },
                { "phrase": "and now here he is,", "tooltip": "e agora aqui ele está" },
                { "phrase": "a full-grown adult", "tooltip": "um adulto totalmente crescido" },
                { "phrase": "in a church basement", "tooltip": "em um porão de igreja" },
                { "phrase": "in the 137th nicest city in America,", "tooltip": "na 137ª cidade mais legal da América" },
                { "phrase": "divorced,", "tooltip": "divorciado" },
                { "phrase": "addicted to video games,", "tooltip": "viciado em videogames" },
                { "phrase": "mostly friendless,", "tooltip": "majoritariamente sem amigos" },
                { "phrase": "eking out a meager living", "tooltip": "sobrevivendo uma vida miserável" },
                { "phrase": "by exploiting his cancertastic past,", "tooltip": "explorando seu passado cancer-tástico" },
                { "phrase": "slowly working his way", "tooltip": "lentamente trabalhando seu caminho" },
                { "phrase": "toward a master’s degree", "tooltip": "em direção a um mestrado" },
                { "phrase": "that will not improve his career prospects,", "tooltip": "que não vai melhorar suas perspectivas de carreira" },
                { "phrase": "waiting, as we all do,", "tooltip": "esperando, como nós todos fazemos" },
                { "phrase": "for the sword of Damocles", "tooltip": "pela espada de Dâmocles" },
                { "phrase": "to give him the relief", "tooltip": "para dar a ele o alívio" },
                { "phrase": "that he escaped lo those many years ago", "tooltip": "do qual ele escapou há muitos anos atrás" },
                { "phrase": "when cancer took both of his nuts", "tooltip": "quando o câncer levou as duas bolas dele" },
                { "phrase": "but spared what only the most generous soul", "tooltip": "mas poupou o que só a alma mais generosa" },
                { "phrase": "would call his life.", "tooltip": "chamaria de vida dele" },
                { "phrase": "AND YOU TOO MIGHT BE SO LUCKY!", "tooltip": "E VOCÊ TAMBÉM PODERIA TER TANTA SORTE!" },
                { "phrase": "Then we introduced ourselves:", "tooltip": "então nós nos apresentamos:" },
                { "phrase": "Name. Age. Diagnosis.", "tooltip": "nome. idade. diagnóstico." },
                { "phrase": "And how we’re doing today.", "tooltip": "e como nós estamos hoje" },
                { "phrase": "I’m Hazel,", "tooltip": "eu sou Hazel" },
                { "phrase": "I’d say when they’d get to me.", "tooltip": "eu dizia quando eles chegavam em mim" },
                { "phrase": "Sixteen.", "tooltip": "dezesseis" },
                { "phrase": "Thyroid originally", "tooltip": "tireoide originalmente" },
                { "phrase": "but with an impressive", "tooltip": "mas com uma impressionante" },
                { "phrase": "and long-settled satellite colony in my lungs.", "tooltip": "e há muito instalada colônia satélite nos meus pulmões" },
                { "phrase": "And I’m doing okay.", "tooltip": "e eu estou indo bem" },
                { "phrase": "Once we got around the circle,", "tooltip": "uma vez que nós demos a volta no círculo" },
                { "phrase": "Patrick always asked", "tooltip": "Patrick sempre perguntava" },
                { "phrase": "if anyone wanted to share.", "tooltip": "se alguém queria compartilhar" },
                { "phrase": "And", "tooltip": "e" },
                { "phrase": "then began", "tooltip": "então começou" },
                { "phrase": "the circle jerk of support:", "tooltip": "a masturbação coletiva de apoio (ironia para apoio exagerado)" },
                { "phrase": "everyone talking about fighting", "tooltip": "todos falando sobre lutar" },
                { "phrase": "and battling", "tooltip": "e batalhar" },
                { "phrase": "and winning", "tooltip": "e vencer" },
                { "phrase": "and shrinking", "tooltip": "e encolher (referência a tumor diminuindo)" },
                { "phrase": "and scanning.", "tooltip": "e escanear (exames de imagem)" },
                { "phrase": "To be fair to Patrick,", "tooltip": "para ser justo com Patrick" },
                { "phrase": "he let us talk about dying, too.", "tooltip": "ele nos deixava falar sobre morrer também" },
                { "phrase": "But most of them weren’t dying.", "tooltip": "mas a maioria deles não estava morrendo" },
                { "phrase": "Most would live into adulthood,", "tooltip": "a maioria viveria até a idade adulta" },
                { "phrase": "as Patrick had.", "tooltip": "como Patrick tinha vivido" },
                { "phrase": "The only redeeming facet of Support Group", "tooltip": "O único aspecto redentor do Grupo de Apoio" },
                { "phrase": "was this kid named Isaac,", "tooltip": "era esse garoto chamado Isaac," },
                { "phrase": "a long-faced,", "tooltip": "de rosto comprido," },
                { "phrase": "skinny guy with straight blond hair", "tooltip": "cara magro com cabelo loiro liso" },
                { "phrase": "swept over one eye.", "tooltip": "varrido sobre um olho." },
                { "phrase": "And his eyes were the problem.", "tooltip": "E os olhos dele eram o problema." },
                { "phrase": "He had some fantastically improbable eye cancer.", "tooltip": "Ele tinha um câncer de olho fantasticamente improvável." },
                { "phrase": "One eye had been cut out", "tooltip": "Um olho tinha sido arrancado" },
                { "phrase": "when he was a kid,", "tooltip": "quando ele era criança," },
                { "phrase": "and now he wore", "tooltip": "e agora ele usava" },
                { "phrase": "the kind of thick glasses", "tooltip": "o tipo de óculos grossos" },
                { "phrase": "that made his eyes", "tooltip": "que faziam seus olhos" },
                { "phrase": "(both the real one and the glass one)", "tooltip": "(tanto o real quanto o de vidro)" },
                { "phrase": "preternaturally huge,", "tooltip": "preternaturalmente enormes," },
                { "phrase": "like his whole head", "tooltip": "como se a cabeça inteira dele" },
                { "phrase": "was basically just this fake eye", "tooltip": "fosse basicamente só esse olho falso" },
                { "phrase": "and this real eye staring at you.", "tooltip": "e esse olho real encarando você." },
                { "phrase": "From what I could gather", "tooltip": "Pelo que eu podia perceber" },
                { "phrase": "on the rare occasions", "tooltip": "nas raras ocasiões" },
                { "phrase": "when Isaac shared with the group,", "tooltip": "em que Isaac compartilhava com o grupo," },
                { "phrase": "a recurrence had placed", "tooltip": "uma recorrência tinha colocado" },
                { "phrase": "his remaining eye", "tooltip": "o olho que restava dele" },
                { "phrase": "in mortal peril.", "tooltip": "em perigo mortal." },
                { "phrase": "Isaac and I communicated", "tooltip": "Isaac e eu nos comunicávamos" },
                { "phrase": "almost exclusively through sighs.", "tooltip": "quase exclusivamente através de suspiros." },
                { "phrase": "Each time someone discussed", "tooltip": "Cada vez que alguém discutia" },
                { "phrase": "anticancer diets", "tooltip": "dietas anticâncer" },
                { "phrase": "or snorting ground-up shark fin or whatever,", "tooltip": "ou cheirar barbatana de tubarão moída ou sei lá o quê," },
                { "phrase": "he’d glance over at me", "tooltip": "ele dava uma olhada para mim" },
                { "phrase": "and sigh ever so slightly.", "tooltip": "e suspirava bem de leve." },
                { "phrase": "I’d shake my head microscopically", "tooltip": "eu balançava minha cabeça microscopicamente" },
                { "phrase": "and exhale in response.", "tooltip": "e exalava em resposta." },
                { "phrase": "Me: \"I refuse to attend Support Group.\"", "tooltip": "Eu: \"Eu me recuso a frequentar o Grupo de Apoio.\"" },
                { "phrase": "Mom: \"One of the symptoms of depression", "tooltip": "Mãe: \"Um dos sintomas da depressão" },
                { "phrase": "is disinterest in activities.\"", "tooltip": "é o desinteresse por atividades.\"" },
                { "phrase": "Me: \"Please just let me watch", "tooltip": "Eu: \"Por favor, só me deixa assistir" },
                { "phrase": "America’s Next Top Model.", "tooltip": "America’s Next Top Model." },
                { "phrase": "It’s an activity.\"", "tooltip": "É uma atividade.\"" },
                { "phrase": "Mom: \"Television is a passivity.\"", "tooltip": "Mãe: \"Televisão é uma passividade.\"" },
                { "phrase": "Me: \"Ugh, Mom, please.\"", "tooltip": "Eu: \"Ah, mãe, por favor.\"" },
                { "phrase": "Mom: \"Hazel, you’re a teenager.", "tooltip": "Mãe: \"Hazel, você é uma adolescente." },
                { "phrase": "You’re not a little kid anymore.", "tooltip": "Você não é mais uma criancinha." },
                { "phrase": "You need to make friends,", "tooltip": "Você precisa fazer amigos," },
                { "phrase": "get out of the house,", "tooltip": "sair de casa," },
                { "phrase": "and live your life.\"", "tooltip": "e viver sua vida.\"" },
                { "phrase": "Me: \"If you want me to be a teenager,", "tooltip": "Eu: \"Se você quer que eu seja uma adolescente," },
                { "phrase": "don’t send me to Support Group.", "tooltip": "não me mande para o Grupo de Apoio." },
                { "phrase": "Buy me a fake ID", "tooltip": "Compre uma identidade falsa pra mim" },
                { "phrase": "so I can go to clubs,", "tooltip": "para que eu possa ir a baladas," },
                { "phrase": "drink vodka,", "tooltip": "beber vodka," },
                { "phrase": "and take pot.\"", "tooltip": "e fumar maconha.\"" },
                { "phrase": "Mom: “You don’t take pot, for starters.”", "tooltip": "Mãe: 'Você não toma maconha, pra começar.' (correção irônica do erro da Hazel)" },
                { "phrase": "Me: “See, that’s the kind of thing I’d know if you got me a fake ID.”", "tooltip": "Eu: 'Viu, esse é o tipo de coisa que eu saberia se você me conseguisse uma identidade falsa.'" },
                { "phrase": "Mom: “You’re going to Support Group.”", "tooltip": "Mãe: 'Você vai para o Grupo de Apoio.'" },
                { "phrase": "Me: “UGGGGGGGGGGGGG.”", "tooltip": "Eu: 'AAARRRGGGHHHHH.' (resmungo de frustração)" },
                { "phrase": "Mom: “Hazel, you deserve a life.”", "tooltip": "Mãe: 'Hazel, você merece uma vida.'" },
                { "phrase": "That shut me up,", "tooltip": "Isso me calou," },
                { "phrase": "although I failed to see how attendance at Support Group", "tooltip": "embora eu não conseguisse ver como frequentar o Grupo de Apoio" },
                { "phrase": "met the definition of life.", "tooltip": "se encaixava na definição de 'vida'." },
                { "phrase": "Still, I agreed to go—", "tooltip": "Ainda assim, eu concordei em ir—" },
                { "phrase": "after negotiating the right to record", "tooltip": "depois de negociar o direito de gravar" },
                { "phrase": "the 1.5 episodes of ANTM I’d be missing.", "tooltip": "os 1,5 episódios de ANTM que eu perderia." },
                { "phrase": "I went to Support Group", "tooltip": "Eu fui ao Grupo de Apoio" },
                { "phrase": "for the same reason that I’d once allowed nurses", "tooltip": "pela mesma razão que uma vez permiti que enfermeiras" },
                { "phrase": "with a mere eighteen months of graduate education", "tooltip": "com meros dezoito meses de formação de pós-graduação" },
                { "phrase": "to poison me with exotically named chemicals:", "tooltip": "me envenenassem com produtos químicos de nomes exóticos:" },
                { "phrase": "I wanted to make my parents happy.", "tooltip": "eu queria deixar meus pais felizes." },
                { "phrase": "There is only one thing in this world shittier than biting it from cancer when you’re sixteen,", "tooltip": "Só há uma coisa neste mundo mais miserável do que morrer de câncer aos dezesseis," },
                { "phrase": "and that’s having a kid who bites it from cancer.", "tooltip": "e é ter um filho que morre de câncer." },
                { "phrase": "Mom pulled into the circular driveway", "tooltip": "Mamãe entrou na garagem circular" },
                { "phrase": "behind the church at 4:56.", "tooltip": "atrás da igreja às 4:56." },
                { "phrase": "I pretended to fiddle with my oxygen tank", "tooltip": "Fingi mexer no meu cilindro de oxigênio" },
                { "phrase": "for a second just to kill time.", "tooltip": "por um segundo só pra matar o tempo." },
                { "phrase": "“Do you want me to carry it in for you?”", "tooltip": "“Você quer que eu leve isso pra dentro pra você?”" },
                { "phrase": "“No, it’s fine,” I said.", "tooltip": "“Não, tá tudo bem”, eu disse." },
                { "phrase": "The cylindrical green tank", "tooltip": "O cilindro verde" },
                { "phrase": "only weighed a few pounds,", "tooltip": "pesava apenas algumas libras" },
                { "phrase": "and I", "tooltip": "e eu" },
                { "phrase": "had this little steel cart", "tooltip": "tinha esse pequeno carrinho de metal" },
                { "phrase": "to wheel it around behind me.", "tooltip": "para rodá-lo ao redor, atrás de mim" },
                { "phrase": "It delivered two liters of oxygen to me each minute", "tooltip": "ele me fornecia dois litros de oxigênio por minuto" },
                { "phrase": "through a cannula,", "tooltip": "através de uma cânula," },
                { "phrase": "a transparent tube that split just beneath my neck,", "tooltip": "um tubo transparente que se dividia logo abaixo do meu pescoço" },
                { "phrase": "wrapped behind my ears,", "tooltip": "passava/envolvido atrás das minhas orelhas" },
                { "phrase": "and then reunited in my nostrils.", "tooltip": "e depois se reunia nas minhas narinas" },
                { "phrase": "The contraption was necessary", "tooltip": "o aparato era necessário" },
                { "phrase": "because my lungs sucked at being lungs.", "tooltip": "porque meus pulmões eram péssimos em ser pulmões" },
                { "phrase": "“I love you,” she said as I got out.", "tooltip": "“Eu te amo,” ela disse enquanto eu saía." },
                { "phrase": "“You too, Mom.", "tooltip": "Você também, mãe." },
                { "phrase": "See you at six.", "tooltip": "Vejo você às seis." },
                { "phrase": "Make friends! she said", "tooltip": "“Faça amigos!” ela disse" },
                { "phrase": "through the rolled-down window", "tooltip": "através da janela abaixada" },
                { "phrase": "as I walked away.", "tooltip": "enquanto eu me afastava." },
                { "phrase": "I didn’t want to take the elevator", "tooltip": "Eu não queria pegar o elevador" },
                { "phrase": "because taking the elevator", "tooltip": "porque pegar o elevador" },
                { "phrase": "is a Last Days kind of activity at Support Group,", "tooltip": "é um tipo de atividade de Últimos Dias no Grupo de Apoio," },
                { "phrase": "so I took the stairs.", "tooltip": "então eu peguei as escadas." },
                { "phrase": "I grabbed a cookie", "tooltip": "Eu peguei um biscoito" },
                { "phrase": "and poured some lemonade into a Dixie cup", "tooltip": "e despejei um pouco de limonada em um copo Dixie" },
                { "phrase": "and then turned around.", "tooltip": "e então me virei." },
                { "phrase": "A boy was staring at me.", "tooltip": "Um garoto estava me encarando." },
                { "phrase": "I was quite sure I’d never seen him before.", "tooltip": "Eu tinha bastante certeza de que eu nunca tinha visto ele antes." },
                { "phrase": "Long and leanly muscular,", "tooltip": "Alto e magro-musculoso," },
                { "phrase": "he dwarfed the molded plastic elementary school chair he was sitting in.", "tooltip": "ele fez parecer pequena a cadeira de plástico moldado de escola primária em que estava sentado." },
                { "phrase": "Mahogany hair,", "tooltip": "Cabelo cor de mogno," },
                { "phrase": "straight and short.", "tooltip": "liso e curto." },
                { "phrase": "He looked my age,", "tooltip": "Ele parecia ter a minha idade," },
                { "phrase": "maybe a year older,", "tooltip": "talvez um ano mais velho," },
                { "phrase": "and he sat with his tailbone against the edge of the chair,", "tooltip": "e ele sentava com o cóccix encostado na borda da cadeira," },
                { "phrase": "his posture aggressively poor,", "tooltip": "sua postura agressivamente ruim," },
                { "phrase": "one hand half in a pocket of dark jeans.", "tooltip": "uma mão meio dentro de um bolso de jeans escuros." },
                { "phrase": "I looked away,", "tooltip": "eu olhei para longe," },
                { "phrase": "suddenly conscious of my myriad insufficiencies.", "tooltip": "de repente consciente das minhas inúmeras insuficiências." },
                { "phrase": "I was wearing old jeans,", "tooltip": "eu estava vestindo jeans velhos," },
                { "phrase": "which had once been tight but now sagged in weird places,", "tooltip": "que antes tinham sido apertados mas agora caíam (pendiam) em lugares estranhos," },
                { "phrase": "and a yellow T-shirt advertising a band I didn’t even like anymore.", "tooltip": "e uma camiseta amarela anunciando uma banda de que eu nem gostava mais." },
                { "phrase": "Also my hair:", "tooltip": "também o meu cabelo:" },
                { "phrase": "I had this pageboy haircut,", "tooltip": "eu tinha esse corte de cabelo estilo 'pageboy'," },
                { "phrase": "and I hadn’t even bothered to, like, brush it.", "tooltip": "e eu nem tinha me dado ao trabalho de, tipo, escová-lo." },
                { "phrase": "Furthermore,", "tooltip": "além disso," },
                { "phrase": "I had ridiculously fat chipmunked cheeks,", "tooltip": "eu tinha bochechas ridiculamente gordas (de esquilo)," },
                { "phrase": "a side effect of treatment.", "tooltip": "um efeito colateral do tratamento." },
                { "phrase": "I looked like a normally proportioned person with a balloon for a head.", "tooltip": "eu parecia uma pessoa de proporções normais com um balão no lugar da cabeça." },
                { "phrase": "This was not even to mention the cankle situation. And", "tooltip": "isso sem nem mencionar a situação dos tornozelos grossos ('cankle' = mistura de calf + ankle). E" },
                { "phrase": "I cut a glance to him,", "tooltip": "dei uma olhada rápida para ele" },
                { "phrase": "and his eyes were still on me.", "tooltip": "e os olhos dele ainda estavam em mim" },
                { "phrase": "It occurred to me", "tooltip": "me ocorreu / me veio à mente" },
                { "phrase": "why they call it eye contact.", "tooltip": "por que chamam isso de contato visual" },
                { "phrase": "I walked into the circle", "tooltip": "entrei no círculo" },
                { "phrase": "and sat down next to Isaac,", "tooltip": "e sentei ao lado de Isaac" },
                { "phrase": "two seats away from the boy;", "tooltip": "duas cadeiras de distância do garoto" },
                { "phrase": "glanced again.", "tooltip": "olhei de novo (um olhar rápido)" },
                { "phrase": "He was still watching me.", "tooltip": "ele ainda estava me observando" },
                { "phrase": "Look, let me just say it:", "tooltip": "Olha, deixa eu só dizer isso:" },
                { "phrase": "He was hot.", "tooltip": "Ele era gato." },
                { "phrase": "A nonhot boy stares at you relentlessly", "tooltip": "Um garoto não atraente encara você sem parar" },
                { "phrase": "and it is, at best, awkward and, at worst, a form of assault.", "tooltip": "e isso é, no melhor dos casos, constrangedor e, no pior, uma forma de agressão." },
                { "phrase": "But a hot boy . . . well.", "tooltip": "Mas um garoto bonito... bem." },
                { "phrase": "I pulled out my phone and clicked it so it would display the time: 4:59.", "tooltip": "eu tirei meu celular e cliquei nele para que mostrasse a hora: 4:59." },
                { "phrase": "The circle filled in with the unlucky twelve-to-eighteens,", "tooltip": "o círculo se preencheu com os azarados de doze a dezoito anos," },
                { "phrase": "and then Patrick started us out with the serenity prayer:", "tooltip": "e então Patrick nos iniciou com a oração da serenidade:" },
                { "phrase": "God, grant me the serenity to accept the things I cannot change,", "tooltip": "Deus, conceda-me a serenidade para aceitar as coisas que não posso mudar," },
                { "phrase": "the courage to change the things I can,", "tooltip": "a coragem para mudar as coisas que posso," },
                { "phrase": "and the wisdom to know the difference.", "tooltip": "e a sabedoria para saber a diferença." },
                { "phrase": "The guy was still staring at me.", "tooltip": "o cara ainda estava me encarando." },
                { "phrase": "I felt rather blushy.", "tooltip": "eu me senti meio corada." }
            ]
        };


        const escapeHtml = s => s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

        const syncMeasurerStyle = (readerEl, measurerEl) => {
            const cs = getComputedStyle(readerEl);
            measurerEl.style.width = cs.width;
            measurerEl.style.paddingTop = cs.paddingTop;
            measurerEl.style.paddingRight = cs.paddingRight;
            measurerEl.style.paddingBottom = cs.paddingBottom;
            measurerEl.style.paddingLeft = cs.paddingLeft;
            measurerEl.style.boxSizing = cs.boxSizing;
            measurerEl.style.fontFamily = cs.fontFamily;
            measurerEl.style.fontSize = cs.fontSize;
            measurerEl.style.lineHeight = cs.lineHeight;
            measurerEl.style.letterSpacing = cs.letterSpacing;
            measurerEl.style.textAlign = "left";
            measurerEl.style.whiteSpace = "normal";
        };

        function isFitPage(text, readerEl, measurerEl, safePx = TIP_SAFE) {
            measurerEl.innerHTML = "<p>" + escapeHtml(text) + "</p>";
            const hM = measurerEl.getBoundingClientRect().height;
            const readerH = readerEl.getBoundingClientRect().height;
            const available = readerH - safePx;
            return hM <= available + 0.5;
        }

        function fitPage(paragraph, safePx = TIP_SAFE + TIP_FOLGA) {
            const readerEl = document.querySelector(".reader");
            const measurerEl = document.getElementById("measurer");
            syncMeasurerStyle(readerEl, measurerEl);
            let low = 0, high = paragraph.length, best = 0;
            if (isFitPage(paragraph, readerEl, measurerEl, safePx)) return paragraph.length;
            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                const candidate = paragraph.slice(0, mid) + "…";
                if (isFitPage(candidate, readerEl, measurerEl, safePx)) { best = mid; low = mid + 1; }
                else { high = mid - 1; }
            }
            return best;
        }

        function buildFullTextWithIndex(items) {
            let fullText = "", index = [], pos = 0;
            items.forEach((it, i) => {
                if (i > 0) { fullText += " "; pos += 1; }
                const start = pos; fullText += it.phrase; const end = pos + it.phrase.length;
                index.push({ start, end, tooltip: it.tooltip }); pos = end;
            });
            return { fullText, index };
        }

        function paginateRanges(fullText) {
            const pages = []; let rest = fullText; let offset = 0;
            while (rest.length > 0) {
                const take = fitPage(rest);
                const len = take > 0 ? take : Math.min(100, rest.length);
                pages.push({ start: offset, end: offset + len });
                rest = rest.slice(len); offset += len;
            }
            return pages;
        }

        // ---- posiciona tooltip dentro da viewport
        function placeTooltip(wrap) {
            const tip = wrap.querySelector('.tooltip');
            if (!tip) return;
            // reset base
            tip.style.left = '0';
            tip.style.right = 'auto';
            tip.style.transform = 'translateY(8px)';

            requestAnimationFrame(() => {
                const vw = window.innerWidth;
                const pad = 8; // margem mínima
                const rWrap = wrap.getBoundingClientRect();
                const rTip = tip.getBoundingClientRect();

                // posição desejada relativa ao wrap (lado esquerdo)
                let desiredLeftViewport = rWrap.left;              // encostar no wrap
                // clamp dentro da viewport
                if (desiredLeftViewport + rTip.width > vw - pad) {
                    desiredLeftViewport = vw - pad - rTip.width;
                }
                if (desiredLeftViewport < pad) {
                    desiredLeftViewport = pad;
                }
                // converte para coordenada relativa ao wrap
                const leftWithinWrap = desiredLeftViewport - rWrap.left;
                tip.style.left = leftWithinWrap + 'px';
            });
        }

        function buildPageHtml(fullText, phraseIndex, range) {
            if (!range) return "";
            const overlaps = phraseIndex
                .filter(({ start, end }) => end > range.start && start < range.end)
                .sort((a, b) => a.start - b.start);

            let html = "", cursor = range.start;
            const pushRaw = (from, to) => { if (to > from) html += escapeHtml(fullText.slice(from, to)); };

            overlaps.forEach(({ start, end, tooltip }) => {
                const s = Math.max(start, range.start);
                const e = Math.min(end, range.end);
                pushRaw(cursor, s);
                const frag = escapeHtml(fullText.slice(s, e));
                const tip = escapeHtml(tooltip || "");
                html += `
                <span class="tip-wrap">
                    <span class="tip-trigger phrase">${frag}</span>
                    <span class="tooltip" role="tooltip">${tip}</span>
                </span>`;
                cursor = e;
            });
            pushRaw(cursor, range.end);
            return html;
        }

        function installTooltipController() {
            const closeAll = () => {
                document.querySelectorAll('.tip-wrap[data-open="true"]').forEach(w => {
                    w.setAttribute('data-open', 'false');
                    const t = w.querySelector('.tip-trigger'); if (t) t.setAttribute('aria-expanded', 'false');
                });
            };

            document.addEventListener('click', (ev) => {
                const trigger = ev.target.closest('.tip-trigger');
                const wrap = ev.target.closest('.tip-wrap');
                if (trigger && wrap) {
                    ev.stopPropagation();
                    const isOpen = wrap.getAttribute('data-open') === 'true';
                    closeAll();
                    wrap.setAttribute('data-open', String(!isOpen));
                    trigger.setAttribute('aria-expanded', String(!isOpen));
                    if (!isOpen) { placeTooltip(wrap); } // posiciona ao abrir
                    return;
                }
                if (!wrap) closeAll();
            });

            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAll(); });

            // Reposiciona tooltips abertos no resize/rotação
            window.addEventListener('resize', () => {
                document.querySelectorAll('.tip-wrap[data-open="true"]').forEach(placeTooltip);
            });
        }

        const clampPage = (p, len) => len <= 0 ? 0 : Math.max(0, Math.min(p, len - 1));

        window.addEventListener("DOMContentLoaded", () => {
            const items = story.page1;
            const { fullText, index: phraseIndex } = buildFullTextWithIndex(items);
            let pages = paginateRanges(fullText);

            const saved = parseInt(localStorage.getItem(STORAGE_KEY) || "0", 10);
            let page = clampPage(Number.isFinite(saved) ? saved : 0, pages.length);

            const reader = document.querySelector(".reader");
            const progress = document.querySelector(".progress");
            const [prevBtn, nextBtn] = document.querySelectorAll(".nav-btn");

            const render = () => {
                if (!pages || pages.length === 0) {
                    reader.innerHTML = ""; progress.textContent = "0%";
                    prevBtn.disabled = nextBtn.disabled = true; return;
                }
                page = clampPage(page, pages.length);
                const range = pages[page];
                reader.innerHTML = buildPageHtml(fullText, phraseIndex, range);
                progress.textContent = `${Math.round(((page + 1) / pages.length) * 100)}%`;
                prevBtn.disabled = page === 0;
                nextBtn.disabled = page === pages.length - 1;
                localStorage.setItem(STORAGE_KEY, String(page));
                document.querySelectorAll('.tip-wrap[data-open="true"]').forEach(w => w.setAttribute('data-open', 'false'));
            };

            prevBtn.addEventListener("click", () => { if (page > 0) { page--; render(); } });
            nextBtn.addEventListener("click", () => { if (page < pages.length - 1) { page++; render(); } });

            // Re-paginar ao redimensionar/rotacionar
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    pages = paginateRanges(fullText);
                    page = clampPage(page, pages.length);
                    render();
                }, 120);
            });

            installTooltipController();
            render();
        });
    </script>
</body>

</html>
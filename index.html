<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Reader</title>
    <style>
        :root {
            --topbar-h: 28px;
            --footer-h: 25px;
        }

        body {
            background-color: #1c1c1c;
            font-family: "Open Sans", sans-serif;
            font-weight: 400;
            font-size: 24px;
            line-height: 1.583;
            letter-spacing: 0.32px;
            text-align: justify;
            display: flex;
            justify-content: center;
        }

        .reader {
            max-width: 994px;
            min-width: 994px;
            padding: 40px;
            color: #cfcfcf;
            background-color: #000;
            padding-left: 125px;
            padding-right: 125px;

            box-sizing: border-box;
            height: calc(100vh - var(--topbar-h) - var(--footer-h));

            margin-top: var(--topbar-h);
            margin-bottom: var(--footer-h);

            overflow: hidden;
        }

        .reader span:hover {
            color: #000;
            background-color: #cecece;
            cursor: pointer;
        }

        .topbar {
            position: fixed;
            inset: 0 0 auto 0;
            height: 35px;
            background: #000;
            display: grid;
            place-items: center;
            border-bottom: 1px solid #1f1f1f;
            z-index: 10;
        }

        .topbar.title {
            font-family: "Open Sans", sans-serif;
            font-size: 13px;
            font-weight: 600;
            color: #555;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: space-around;
            color: #ccc;
            font-size: 16px;
            border-top: 1px solid #333;
            z-index: 10;
        }

        .footer .progress {
            font-size: 14px;
        }

        .footer .nav-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: 26px;
            cursor: pointer;
            padding: 8px;
        }

        .footer .nav-btn:hover {
            color: #fff;
        }

        /* medidor invisível: terá o mesmo estilo que .reader */
        #measurer {
            position: absolute;
            visibility: hidden;
            left: -9999px;
            top: -9999px;
            width: 994px;
            /* will update dynamically to match reader's content width */
            padding: 40px 125px;
            box-sizing: border-box;
            font-size: 24px;
            line-height: 1.583;
            letter-spacing: 0.32px;
            text-align: justify;
            white-space: normal;
        }
    </style>
    <script>
        const strip = (html) => {
            let tmp = document.createElement("div");
            tmp.innerHTML = html;
            const text = tmp.textContent || tmp.innerText || "";

            return text.replace(/\s+/g, " ").trim();
        };

        const book = `<span>I am a lawyer at an engineering company</span>, so I had to pay close attention to every little detail on
  all those papers. I also had to draft a very important contract that could improve our company's future, which filled me
  with anxiety. This document could leave no room for interpretation, so writing it was not an easy task. Every
  word needed to be chosen carefully. If I made a mistake, even a small one, the consequences could be terrible.

  I do not think anyone had lunch that day, just a huge number of cups of coffee. Eventually, people started
  ordering food. I looked at the clock on the wall: it was past 9 pm, so I ate a salad and some garlic bread at my
  desk, which helped me to keep going. Everyone was tired, but we pressed on regardless. aaa aaa aaa aaa aaa aaa aaa aaa aaa 
  aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa bbb aaa aaa aaa aaa aaa aaa aaa aaa 
  aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa 
  aaa aaa aaa aaa aaa aaa aaa ccc aaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaa
  aaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaa
  aaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaa
  aaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaa
  aaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa aaaaaa aaa aaa aaa aaa aaa eee`;

        const escapeHtml = (s) => s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

        const syncMeasurerStyle = (readerEl, measurerEl) => {
            const cs = getComputedStyle(readerEl);
            measurerEl.style.width = cs.width;
            measurerEl.style.paddingTop = cs.paddingTop;
            measurerEl.style.paddingRight = cs.paddingRight;
            measurerEl.style.paddingBottom = cs.paddingBottom;
            measurerEl.style.paddingLeft = cs.paddingLeft;
            measurerEl.style.boxSizing = cs.boxSizing;
            measurerEl.style.fontFamily = cs.fontFamily;
            measurerEl.style.fontSize = cs.fontSize;
            measurerEl.style.lineHeight = cs.lineHeight;
            measurerEl.style.letterSpacing = cs.letterSpacing;
            measurerEl.style.textAlign = cs.textAlign;
            measurerEl.style.whiteSpace = "normal";
        }

        const isFitPage = (text, readerEl, measurerEl) => {
            measurerEl.innerHTML = "<p>" + escapeHtml(text) + "</p>";
            const hM = measurerEl.getBoundingClientRect().height;
            const hR = readerEl.getBoundingClientRect().height;
            return hM <= hR + 0.5;
        }

        const fitPage = (paragraph) => {
            const readerEl = document.querySelector(".reader");
            const measurerEl = document.getElementById("measurer");
            syncMeasurerStyle(readerEl, measurerEl);

            let low = 0;
            let high = paragraph.length;
            let best = 0;

            if (isFitPage(paragraph, readerEl, measurerEl)) return paragraph.length;

            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                const candidate = paragraph.slice(0, mid) + "…";
                if (isFitPage(candidate, readerEl, measurerEl)) {
                    best = mid;
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            return best;
        }

        const paginate = (text) => {
            const pages = [];
            let rest = text;
            while (rest.length > 0) {
                const take = fitPage(rest);
                if (take <= 0) {
                    pages.push(rest.slice(0, 100));
                    rest = rest.slice(100);
                } else {
                    pages.push(rest.slice(0, take));
                    rest = rest.slice(take);
                }
            }
            return pages;
        }

        window.addEventListener("DOMContentLoaded", () => {
            const txt = strip(book);
            const pages = paginate(txt);

            let page = 0;
            const reader = document.querySelector(".reader");
            const progress = document.querySelector(".progress");
            const [prevBtn, nextBtn] = document.querySelectorAll(".nav-btn");

            const render = () => {
                reader.textContent = pages[page];
                progress.textContent = `${Math.round(((page + 1) / pages.length) * 100)}%`;
                prevBtn.disabled = page === 0;
                nextBtn.disabled = page === pages.length - 1;
            }

            prevBtn.addEventListener("click", () => {
                if (page > 0) { page--; render(); }
            });

            nextBtn.addEventListener("click", () => {
                if (page < pages.length - 1) { page++; render(); }
            });

            render();
        });
    </script>
</head>

<body>
    <header class="topbar">
        <div class="topbar title">A Sea of Darkness</div>
    </header>

    <div class="reader"></div>
    <div class="footer">
        <button class="nav-btn">❮</button>
        <span class="progress">0%</span>
        <button class="nav-btn">❯</button>
    </div>

    <!-- medidor invisível -->
    <div id="measurer" aria-hidden="true"></div>
</body>

</html>